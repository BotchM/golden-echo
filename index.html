<!doctype html>
<html>
  <head>
    <title>Carolina</title>
    <meta name="author" content="jonobr1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <link rel="apple-touch-icon" href="./images/apple-touch-icon.png"/>
    <link rel="icon" href="./images/favicon.ico" />
    <link type="text/css" rel="stylesheet" href="./styles/main.css">
  </head>
  <body style="position: absolute; overflow: hidden; width: 100%; height: 100%; top: 0; left: 0;">
    <div id="content"></div>
    <div class="loader"></div>
    <div class="scripts" style="display: none;">

      <script src="./third-party/tween.js"></script>
      <script src="./third-party/three.js"></script>
      <script src="./third-party/two.js"></script>
      <script src="./third-party/sound.js"></script>
      <script src="./third-party/noise.js"></script>
      <script src="./third-party/xhr.js"></script>
      <script src="./third-party/url.js"></script>

      <script src="./src/pool.js"></script>
      <script src="./src/path.js"></script>
      <script src="./src/item.js"></script>
      <script src="./src/items/prog.js"></script>
      <script src="./src/items/kick.js"></script>
      <script src="./src/items/perc.js"></script>
      <script src="./src/items/timpani.js"></script>
      <script src="./src/items/bass.js"></script>
      <script src="./src/items/hook.js"></script>
      <script src="./src/items/guitar.js"></script>
      <script src="./src/items/mellotron.js"></script>
      <script src="./src/items/vanguard.js"></script>
      <script src="./src/carolina.js"></script>
      <script src="./src/eye.js"></script>
      <script>

        var eye = new Eye(100, 100, '#00bcf2').appendTo(document.body);
        eye.watch();
        var startButton = eye.two.renderer.domElement;
        _.extend(startButton.style, {
          position: 'absolute',
          display: 'none',
          top: 50 + '%',
          left: 50 + '%',
          marginLeft: - 50 + 'px',
          marginTop: - 50 + 'px',
          cursor: 'pointer'
        });

        Carolina.init(function() {

          var loader = document.querySelector('.loader');
          createFades(loader);

          loader.fadeOut(function(){

            createFades(startButton);
            document.body.appendChild(startButton);

            startButton.fadeIn();
            eye.two.play();

            var started = false;

            Carolina.__onEnded = function() {
              startButton.fadeIn();
              eye.two.play();
              started = false;
            };

            var start = function() {

              if (started) {
                return;
              }

              eye.blink(function() {

                startButton.fadeOut();
                eye.two.pause();

                Carolina.reset({
                  elapsed: url.number('startTime', 0)
                });
                started = true;

              });

            };

            startButton.addEventListener('mousedown', start, false);
            startButton.addEventListener('touchstart', start, false);
            // startButton.addEventListener('click', start, false);

          });

        });

        function createFades(elem) {
          elem.fadeIn = function(callback) {
            elem.style.display = 'block';
            elem.style.opacity = 0;
            _.delay(function() {
              elem.style.opacity = 1;
              _.delay(function() {
                if (_.isFunction(callback)) {
                  callback();
                }
              }, 350);
            }, 50);
          };
          elem.fadeOut = function(callback) {
            elem.style.opacity = 0;
            _.delay(function() {
              elem.style.display = 'none';
              if (_.isFunction(callback)) {
                callback();
              }
            }, 350);
          };
        }

      </script>

    </div>
  </body>
</html>