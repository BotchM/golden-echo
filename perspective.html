<!doctype html>
<html>
  <head>
  </head>
  <body>
    <div class="scripts">
      <script src="./third-party/tween.js"></script>
      <script src="./third-party/two.js"></script>
      <script src="./src/camera.js"></script>
      <script src="./src/item.js"></script>
      <script>

        var two = new Two({
          type: Two.Types.canvas,
          fullscreen: true,
          autostart: true
        }).appendTo(document.body);

        Item.origin.threshold = two.width / 2;

        var centroid = new Two.Vector(two.width / 2, two.height / 2);

        var camera = new Camera(two.width, two.height / 2);
        camera.translation.set(two.width / 2, two.height);

        var circles = makeCircles(camera);

        var debug = two.makeGroup(camera);
        var stage = two.makeGroup(circles);

        window.addEventListener('mousemove', function(e) {

          var amt = 2 * (e.clientX / two.width) - 1;
          camera.turn(amt / 2);

        });

        two
          .bind('resize', function() {

            centroid.set(two.width / 2, two.height / 2);
            Item.origin.set(two.width / 2, two.height / 2);

          })
          .bind('update', function(frameCount, timeDelta) {

            if (!timeDelta || timeDelta > 1000) {
              return;
            }

            for (var i = 0, l = circles.length; i < l; i++) {
              var circle = circles[i];
              var t = circle.t + timeDelta * circle.step;
              if (t >= 1) {
                t = 0;
                circle.offset.set(
                  Math.random() > 0.5 ? 
                  - Math.random() * Item.origin.threshold - Item.origin.threshold / 2 :
                  Math.random() * Item.origin.threshold + Item.origin.threshold / 2,
                  - Math.random() * two.height
                );
              }
              circle.update(t);
            }

          })
          .trigger('resize');

        function makeCircles(camera) {

          var amt = 50;

          return _.map(_.range(amt), function(i) {

            var pct = i / (amt - 1);
            var r = Math.floor(Math.random() * 25) + 25;
            var s = Item.makeCircle(r);

            s.noStroke();
            s.fill = 'rgb('
              + Math.floor(Math.random() * 255) + ','
              + Math.floor(Math.random() * 255) + ','
              + Math.floor(Math.random() * 255) + ')';

            s.camera = camera;
            s.step = 0.0004;

            s.t = TWEEN.Easing.Sinusoidal.In(Math.random());

            s.offset.set(
              Math.random() > 0.5 ? 
              - Math.random() * Item.origin.threshold - Item.origin.threshold / 2 :
              Math.random() * Item.origin.threshold + Item.origin.threshold / 2,
              - Math.random() * two.height
            );

          return s;

          });

        }

      </script>
    </div>
  </body>
</html>